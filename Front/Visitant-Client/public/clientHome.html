<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spot Home</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
  <style>
    .nav-scroller {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch; /* for iOS smooth scrolling */
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js"></script>
</head>

<body class="font-sans">
  <!-- NavBar -->
  <section>
    <header class="p-3 mb-3 border-bottom">
      <div class="container">
        <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
          <a href="/" class="d-flex align-items-center mb-2 mb-lg-0 link-body-emphasis text-decoration-none">
            <svg class="bi me-2" width="40" height="32" role="img" aria-label="Bootstrap"><use xlink:href="#bootstrap"></use></svg>
          </a>
  
          <ul class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0">
            <li> <a href="../index.html" class="nav-link px-2 link-secondary">SpotHome</a> </li>
            <!-- <li><a href="#" class="nav-link px-2 link-body-emphasis">Mapa</a></li>
            <li><a href="#" class="nav-link px-2 link-body-emphasis">Favoritos</a></li>
            <li><a href="#" class="nav-link px-2 link-body-emphasis">Agendamentos</a></li> -->
          </ul>
  
          <div class="dropdown text-end">
            <a href="#" class="d-block link-body-emphasis text-decoration-none dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
              <img src="https://github.com/mdo.png" alt="mdo" width="32" height="32" class="rounded-circle">
            </a>
            <ul class="dropdown-menu text-small">
              <li><a class="dropdown-item" href="../public/profile.html">Perfil</a></li>
              <!-- <li><a class="dropdown-item" href="#">Favoritos</a></li> -->
              <li><a class="dropdown-item" href="#">Pedidos de visita</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><button class="btn" id="logout-btn">logout</button></li>
            </ul>
          </div>
        </div>
      </div>
    </header>
  </section>

  <!-- Scrollable options  -->
  <section>
    <div class="container">
      <div class="nav-scroller py-1 mb-0">
        <nav class="nav nav-underline justify-content-evenly flex-nowrap overflow-auto">
          <div class="col-5 col-md-3">
            <a class="nav-item nav-link link-body-emphasis" href="#"> <img src="../assets/images/icons/building.svg" alt="Apartament" height="25"> Apartamento</a>
          </div>

          <div class="col-5 col-md-3">
            <a class="nav-item nav-link link-body-emphasis" href="#"> <img src="../assets/images/icons/house.svg" alt="" height="25"> Vivenda</a>
          </div>

          <div class="col-3 col-md-3">
            <a class="nav-item nav-link link-body-emphasis" href="#"> <img src="../assets/images/icons/farm.svg" alt="" height="25"> Quinta</a>
          </div>

          <div class="col-4 col-md-2">
            <a class="nav-item nav-link link-body-emphasis" href="#"> <img src="../assets/images/icons/garage.svg" alt="" height="25"> Garagem</a>
          </div>

          <div class="col-5 col-md-2">
            <a class="nav-item nav-link link-body-emphasis" href="#"> <img src="../assets/images/icons/apartment.svg" alt="" height="25"> Condominío</a>
          </div>
        </nav>
      </div>
    </div>
  </section>

  <!-- Advanced search -->
  <section>
    <nav class="navbar border-top pt-5">
      <div class="container-fluid">
        <div class="row w-100 d-flex justify-content-center">
          <!-- Search bar -->
          <div class="col-12 col-md-8 col-lg-10 mb-2 mb-md-0">
            <form class="d-flex" role="search">
              <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                <a href="#"> <div class="btn btn-outline-primary me-2 " type="submit">Pesquisar</div> </a> 
                <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#filtroModal"> Filtros</button>
            </form>
          </div>
        </div>
      </div>
    </nav>
  </section>
  
<!-- Modal de Filtros -->
  <section>
    <div class="modal fade" id="filtroModal" tabindex="-1" aria-labelledby="filtroModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content rounded-4 shadow">
          <div class="modal-header">
            <h5 class="modal-title" id="filtroModalLabel">Filtrar Propriedades</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
          </div>
          <div class="modal-body">
            <form id="filtroForm" class="row g-3">
              <div class="col-md-6">
                <label for="tipologia" class="form-label">Tipologia</label>
                <select id="tipologia" class="form-select">
                  <option value="">Escolha...</option>
                  <option value="T1">T1</option>
                  <option value="T2">T2</option>
                  <option value="T3">T3</option>
                  <option value="T4+">T4+</option>
                </select>
              </div>

              <div class="col-md-6">
                <label for="localizacao" class="form-label">Localização</label>
                <input type="text" class="form-control" id="localizacao" placeholder="Ex: Lisboa">
              </div>

              <div class="col-md-6">
                <label for="precoMin" class="form-label">Preço Mínimo (€)</label>
                <input type="number" class="form-control" id="precoMin" placeholder="0">
              </div>

              <div class="col-md-6">
                <label for="precoMax" class="form-label">Preço Máximo (€)</label>
                <input type="number" class="form-control" id="precoMax" placeholder="1000000">
              </div>

              <div class="col-md-4">
                <label for="wcs" class="form-label">Nº de WC's</label>
                <input type="number" class="form-control" id="wcs">
              </div>

              <div class="col-md-4">
                <label for="ano" class="form-label">Ano de Construção</label>
                <input type="number" class="form-control" id="ano">
              </div>

              <div class="col-md-2">
                <div class="form-check mt-4">
                  <input class="form-check-input" type="checkbox" id="quintal">
                  <label class="form-check-label" for="quintal">Quintal</label>
                </div>
              </div>

              <div class="col-md-2">
                <div class="form-check mt-4">
                  <input class="form-check-input" type="checkbox" id="piscina">
                  <label class="form-check-label" for="piscina">Piscina</label>
                </div>
              </div>
            </form>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            <button type="button" class="btn btn-primary" onclick="aplicarFiltros()">Aplicar Filtros</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- houses examples part1 -->
<section>
  <div class="container px-4" id="houses-section">
    <div class="row row-cols-1 row-cols-lg-3 align-items-stretch g-4 py-5" id="houses-grid">
      <!-- JS irá preencher aqui -->
    </div>
  </div>
</section>

<script>

  function aplicarFiltros() {
  const tipologia = document.getElementById('tipologia').value;
  const localizacao = document.getElementById('localizacao').value.toLowerCase();
  const precoMin = parseInt(document.getElementById('precoMin').value) || 0;
  const precoMax = parseInt(document.getElementById('precoMax').value) || Infinity;
  const wcs = parseInt(document.getElementById('wcs').value);
  const ano = parseInt(document.getElementById('ano').value);
  const quintal = document.getElementById('quintal').checked;
  const piscina = document.getElementById('piscina').checked;

  const housesFiltradas = houseList.filter(house => {
    const precoFicticio = 300000; // você pode substituir por dados reais futuramente
    const contemQuintal = house.description.toLowerCase().includes("quintal");
    const contemPiscina = house.description.toLowerCase().includes("piscina");

    return (
      (!tipologia || house.title.includes(tipologia)) &&
      (!localizacao || house.title.toLowerCase().includes(localizacao)) &&
      (precoFicticio >= precoMin && precoFicticio <= precoMax) &&
      (!isNaN(wcs) ? house.description.includes(`${wcs} casas de banho`) : true) &&
      (!isNaN(ano) ? true : true) && // precisa de campo ano nos dados
      (!quintal || contemQuintal) &&
      (!piscina || contemPiscina)
    );
  });

  grid.innerHTML = "";
  housesFiltradas.forEach((house, i) => {
    // Reuse logic to render cards (como no seu código atual)
    // ou mova o código de renderização para uma função reutilizável
  });

  // Fechar o modal
  const modal = bootstrap.Modal.getInstance(document.getElementById('filtroModal'));
  modal.hide();
}
  // Define the list of houses (title, description, and images)
  const houseList = [
    {
      title: "Moradia Moderna em Lisboa",
      description: "3 quartos · 2 casas de banho · 180m² · Jardim e garagem privada.",
      images: ["../assets/images/image1.jpeg", "../assets/images/image2.jpg", "../assets/images/image3.jpg"]
    },
    {
      title: "Apartamento Luxuoso em Porto",
      description: "2 quartos · 2 casas de banho · 120m² · Varanda com vista.",
      images: ["../assets/images/image2.jpg", "../assets/images/image3.jpg", "../assets/images/image1.jpeg"]
    },
    {
      title: "Vivenda Familiar em Coimbra",
      description: "4 quartos · 3 casas de banho · 250m² · Piscina e jardim.",
      images: ["../assets/images/image3.jpg", "../assets/images/image1.jpeg", "../assets/images/image2.jpg"]
    },
    {
      title: "Casa Térrea em Faro",
      description: "2 quartos · 1 casa de banho · 90m² · Quintal espaçoso.",
      images: ["../assets/images/image1.jpeg", "../assets/images/image2.jpg", "../assets/images/image3.jpg"]
    },
    {
      title: "Moradia com Vista Mar",
      description: "5 quartos · 4 casas de banho · 300m² · Terraço e garagem dupla.",
      images: ["../assets/images/image2.jpg", "../assets/images/image1.jpeg", "../assets/images/image3.jpg"]
    },
    {
      title: "Apartamento Compacto em Braga",
      description: "1 quarto · 1 casa de banho · 60m² · Ideal para casal jovem.",
      images: ["../assets/images/image3.jpg", "../assets/images/image2.jpg", "../assets/images/image1.jpeg"]
    }
  ];

  // Get the div where we want to add the house cards
  const grid = document.getElementById("houses-grid");

  // Loop through each house and build the HTML
  for (let i = 0; i < houseList.length; i++) {
    const house = houseList[i];
    const carouselId = "carousel" + (i + 1);

    // Start the carousel HTML
    let carouselHTML = '<div id="' + carouselId + '" class="carousel slide">';
    carouselHTML += '<div class="carousel-inner">';

    // Add each image in the carousel
    for (let j = 0; j < house.images.length; j++) {
      const activeClass = j === 0 ? "active" : "";
      carouselHTML += '<div class="carousel-item ' + activeClass + '">';
      carouselHTML += '<img src="' + house.images[j] + '" class="d-block w-100" alt="House image">';
      carouselHTML += '</div>';
    }

    carouselHTML += '</div>'; // close carousel-inner

    // Add carousel controls (previous/next buttons)
    carouselHTML += `
      <button class="carousel-control-prev" type="button" data-bs-target="#${carouselId}" data-bs-slide="prev">
        <span class="carousel-control-prev-icon"></span>
        <span class="visually-hidden">Previous</span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#${carouselId}" data-bs-slide="next">
        <span class="carousel-control-next-icon"></span>
        <span class="visually-hidden">Next</span>
      </button>
    `;
    carouselHTML += '</div>'; // close carousel

    // Now create the full card HTML with carousel and text
    const cardHTML = `
      <div class="col">
        <div class="card shadow-lg rounded-4 overflow-hidden position-relative">
          ${carouselHTML}
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <h5 class="card-title fw-semibold">${house.title}</h5>
              <a href="#" title="Favoritar">
                <img src="../assets/images/icons/heartss.png" alt="Favorito" width="24" height="24">
              </a>
            </div>
            <p class="card-text text-muted small">${house.description}</p>
            <div class="d-flex gap-2 mt-3">
              <a href='../public/clientHomeDetails.html'> <button class="btn btn-outline-primary btn-sm">Mais Detalhes</button>  </a>
            </div>
          </div>
        </div>
      </div>
    `;

    // Add the card to the page
    grid.innerHTML += cardHTML;
  }
</script>
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js" integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq" crossorigin="anonymous"></script>
  <script src="./app.js"></script>
   <script src="../api/user.js"></script>
   <script src="../api/house.js"></script>
   <script src="../handle/logout.js"></script>

</body>
</html>